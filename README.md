# Pyth Network Price 

## Overview

TypeScript implementation for decoding, filtering, and re-encoding Pyth Network price feed data for gas-optimized blockchain transactions.



## Architecture

### Data Flow

1. **Fetch** → Hermes API retrieves AccumulatorUpdateData
2. **Decode** → Parse binary format (PNAU header + VAA + price feeds)
3. **Filter** → Select subset of price feeds
4. **Re-encode** → Reconstruct optimized payload
5. **Validate** → Ensure Pyth contract compatibility

### Price Feed Message Format (85 bytes)

```
[1B] Message Type (0x00)
[32B] Feed ID
[8B] Price (signed int64 BE)
[8B] Confidence (uint64 BE)
[4B] Exponent (int32 BE)
[8B] Publish Time (uint64 BE)
[8B] Previous Publish Time (uint64 BE)
[8B] EMA Price (signed int64 BE)
[8B] EMA Confidence (uint64 BE)
```

### Key Functions

- `decodeAccumulatorUpdateData()` - Parses binary Pyth format
- `parsePriceFeedMessage()` - Extracts individual price data
- `encodeAccumulatorUpdateData()` - Reconstructs filtered payload
- `encodePriceFeedMessage()` - Converts struct to binary


## Output with hardcoded queries 

``` Original calldata length: 15046 characters
Total price feeds found: 20
VAA size: 952 bytes

Selected assets:
[
  'bade5c63f281d36a13dbb64ed0ae1c532a434b6771b11885f396a41f56cc3bd0',
  'f253cf87dc7d5ed5aa14cba5a6e79aee8bcfaef885a0e1b807035a0bbecc36fa',
  '2817d7bfe5c64b8ea956e9a26f573ef64e72e4d7891f2d6af9bcc93f7aff9a97',
  '42bfb26778f3504a9f359a92c731f77d0c24aed9b7745276e3ad0c2d840b74c2',
  'b04edaa5eba1fb048c18b727466681894f0ab21dd89643432af0277162dedb6d'
]
Re-encoded calldata successfully
Original size: 15046 characters
Filtered size: 2808 characters
calldata param for updatePriceFeeds() function: 
 "0x504e41550100000003b801000000040d005e75e971b3e96e290a95ba3f31e1139725ecc02f9a23dcd9d7332f8aa3f065bf0a47fe23f98e4ca7727cf54b0a904ada0c00e79e24ca7802825a528303e7301701023b5e54ed1fcde2e6288960384f3af1e675ba771693a2b1d42cdf6cb4510ccdc36c3d46bf731094f2b7e2cab6797b4b1680200ca229ca0fef8171f79905abcd0b0003a9230ce81cf585e941e895a6a172b443a358fd01aeba3fda593e9bd77a8341cd60ea3e69a8b198817af100ca52a0c09924b826405c0464754c147c8c9a3bc0970004016b463b11023427e4c18a274422d9ff294b8f47070df0cf13e6cffc962aec0a1998bce7ac0f4a907b33c02e0afae9746a246a8538ee618aef6f454e56a42d610106ed05841c1c561fcab4b6c63e88099f04b241977e1c463d1395cf916f3f75f7f92ce858863af30a8c4f156efaaff18c2626aca2962af6c503769ead930146dcb8000ad7d2ff2bdff1dbfa53d6f1bc29880e08117687d8205bff5c52040b1bd7fbce8b19012c122eeae4b2a0aa0e9319c690d8594151d05ce47f145420cb63ce1af006000b57b1ee05687fdd31cdb102843a5415805f7824623eef286a8c7f7185c9f5079027fb671107c99bf6d1cd1fc7e2db6d00f50d41d5df4a6b4920fea8bd6642177f010cdee712d3d3dd25dc3974f34cc34d3461960a602c83864499f8c6637214a9c9d635a1a43447cbbf03e6d166e49fb20304dd50dc2dfc4cda60546a05a2637afd5f010d0ddbd9217f9f411aa1e094410c7d87b2835c14c49b5f921ff73e3e26fb240f0335a0f24010c7b0c3f8797228b4073916561efb23015b8d55e7a6a4380f7c68d2000e2761eab2b557ee050b04c052ed4889f236c00e5846084882af9eca263ef71dd15ea4ea5cba975c84f6eb91859b74ce3c5978d79d8c49c954216c58593d351230000fc77db5d80f5c707b681e1b321a9d4c99d4871204339817aab5697359f7aff72d632552ba343ba9fc663d836f9b566d17045ca987591540cf8e487c18997978720010416ed7c7af494ea5c61b92690ca5ac8d9771d26c744b47aa05a8740520b099fd456569eb3ce2e3a08d4aa587767af56266283bbf136886bba651cd7bf6902e1b01116cdec72ee4c6202f8f8c7cd319793f9a259d19b607c01725c05a5e0cd4e08c8b5869d070645f2ac20909d8275519aba80ea2df303499c0d4da785ab0b966083301683c63ea00000000001ae101faedac5851e32b9b23b5f9411a8c2bac4aae3ed4dd7b811dd1a72ea4aa710000000008196d2b014155575600000000000d26ee6800002710048e598caee3a717ca07f47f1a96594e3f62c7ec05005500bade5c63f281d36a13dbb64ed0ae1c532a434b6771b11885f396a41f56cc3bd00000000005f5e1000000000000000001fffffff800000000683c63ea00000000683c63ea0000000005f5e100000000000000000100005500f253cf87dc7d5ed5aa14cba5a6e79aee8bcfaef885a0e1b807035a0bbecc36fa0003b691a8541c81000002d9529a1b46fffffff600000000683c63ea00000000683c63ea0003b3c6e232ab8000000266c1af2240000055002817d7bfe5c64b8ea956e9a26f573ef64e72e4d7891f2d6af9bcc93f7aff9a9700000985aefb2e75000000048c97026afffffff800000000683c63ea00000000683c63ea0000097df28711200000000452310e380000550042bfb26778f3504a9f359a92c731f77d0c24aed9b7745276e3ad0c2d840b74c20000098d89303bf200000007899cd102fffffff800000000683c63ea00000000683c63ea0000098011851c0000000006646c493000005500b04edaa5eba1fb048c18b727466681894f0ab21dd89643432af0277162dedb6d00000000000000000000000000000000fffffff8000000000000000000000000000000000000000000000000000000000000000000";
 
 ``` 



